# SIMPLIFIED TEST QUERIES
# Copy and paste these into Splunk Search Bar
# ==========================================================================================

# Test 1: Phishing Activity Detected via NLP Pattern Matching (Lazarus Group)
# T1566.001 - Phishing
index=* sourcetype="WinEventLog:Security" | search ((Parent_Process_Name="*\WINWORD.EXE" OR Parent_Process_Name="*\EXCEL.EXE" OR Parent_Process_Name="*\POWERPNT.EXE" OR Parent_Process_Name="*\OUTLOOK.EXE") AND (New_Process_Name="*\cmd.exe" OR New_Process_Name="*\powershell.exe" OR New_Process_Name="*\rundll32.exe" OR New_Process_Name="*\regsvr32.exe" OR New_Process_Name="*\mshta.exe") AND (Process_Command_Line="*powershell.exe -enc*" OR Process_Command_Line="*cmd.exe /c start*" OR Process_Command_Line="*rundll32.exe javascript:*" OR Process_Command_Line="*regsvr32.exe /s /i:*" OR Process_Command_Line="*mshta.exe javascript:*")) NOT ((Process_Command_Line="*\"C:\Program Files\Microsoft Office\"*" OR Process_Command_Line="*\"C:\Program Files (x86)\Microsoft Office\"*" OR Process_Command_Line="*\AppData\Local\Microsoft\Windows\INetCache*" OR Process_Command_Line="*\AppData\Local\Temp*") AND (New_Process_Name="*\cmd.exe" OR New_Process_Name="*\powershell.exe" OR New_Process_Name="*\rundll32.exe" OR New_Process_Name="*\regsvr32.exe" OR New_Process_Name="*\mshta.exe") AND (Parent_Process_Name="*\WINWORD.EXE" OR Parent_Process_Name="*\EXCEL.EXE" OR Parent_Process_Name="*\POWERPNT.EXE" OR Parent_Process_Name="*\OUTLOOK.EXE")) | table _time, ComputerName, New_Process_Name, Parent_Process_Name, Process_Command_Line, Process_ID, Subject_User_Name

# Test 2: Lazarus Group PowerShell Activity - Mimikatz Indicators
# T1059.001 - PowerShell
index=* sourcetype="WinEventLog:Security" | search New_Process_Name="C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe" AND (Process_Command_Line="*-enc *" OR Process_Command_Line="*Invoke-WebRequest*" OR Process_Command_Line="*IEX (New-Object Net.WebClient).DownloadString*" OR Process_Command_Line="*powershell.exe -nop -w hidden -c*" OR Process_Command_Line="*powershell.exe -ep bypass*" OR Process_Command_Line="*Invoke-Expression*" OR Process_Command_Line="*cmd.exe /c powershell*" OR Process_Command_Line="*powershell.exe -ExecutionPolicy Bypass*") | table _time, ComputerName, New_Process_Name, Parent_Process_Name, Process_Command_Line, Process_ID, Subject_User_Name

# Test 3: Suspicious Registry Run Key Creation via NLP Pattern Matching
# T1547.001 - Registry Run Keys
index=* sourcetype="WinEventLog:Security" | search (New_Process_Name="*\reg.exe" AND (Process_Command_Line="*ADD*" OR Process_Command_Line="*HKCU\Software\Microsoft\Windows\CurrentVersion\Run*" OR Process_Command_Line="*/v*" OR Process_Command_Line="*/t*" OR Process_Command_Line="*/d*")) NOT ((Process_Command_Line="*\"C:\Program Files\\"*" OR Process_Command_Line="*\"C:\Windows\\"*" OR Process_Command_Line="*\"C:\ProgramData\\"*" OR Process_Command_Line="*\"C:\Users\Public\\"*" OR Process_Command_Line="*\"C:\Users\Default\\"*" OR Process_Command_Line="*\"C:\Users\All Users\\"*" OR Process_Command_Line="*\"C:\Program Files (x86)\*") AND ((Process_Command_Line LIKE ""C:\\Program Files\\.*\\.*\\.*.exe" /d") OR (Process_Command_Line LIKE ""C:\\Program Files (x86)\\.*\\.*\\.*.exe" /d"))) | table _time, ComputerName, New_Process_Name, Parent_Process_Name, Process_Command_Line, Process_ID, Subject_User_Name

# Test 4: OS Credential Dumping via Mimikatz and Procdump
# T1003 - OS Credential Dumping
index=* sourcetype="WinEventLog:Security" | search (((Parent_Process_Name="*\powershell.exe" OR Parent_Process_Name="*\powershell_ise.exe") AND (Process_Command_Line="*-enc *" OR Process_Command_Line="*Invoke-WebRequest*" OR Process_Command_Line="*IEX (New-Object Net.WebClient).DownloadString*" OR Process_Command_Line="*bypass*" OR Process_Command_Line="*DownloadString*"))) NOT ((New_Process_Name="*\conhost.exe" OR New_Process_Name="*\svchost.exe" OR New_Process_Name="*\consent.exe") AND (Process_Command_Line="*\"/c echo off\"*" OR Process_Command_Line="*\"/c timeout\"*" OR Process_Command_Line="*\"/c ping\"*" OR Process_Command_Line="*\"/c tasklist\"*") AND (Parent_Process_Name="*\explorer.exe" OR Parent_Process_Name="*\cmd.exe" OR Parent_Process_Name="*\powershell.exe")) | table _time, ComputerName, New_Process_Name, Parent_Process_Name, Process_Command_Line, Process_ID, Subject_User_Name

# Test 5: Remote Desktop Protocol Activity Detected via NLP Pattern Matching
# T1021.001 - Remote Desktop Protocol
index=* sourcetype="WinEventLog:Security" | search ((Process_Command_Line="*mstsc.exe*" OR Process_Command_Line="*Remote Desktop Connection*" OR Process_Command_Line="*/v:*" OR Process_Command_Line="*/admin*" OR Process_Command_Line="*/console*") AND New_Process_Name="*mstsc.exe") NOT ((Process_Command_Line="*\"C:\Program Files\Remote Desktop Connection\mstsc.exe\"*" OR Process_Command_Line="*\"C:\Windows\System32\mstsc.exe\"*") AND (Parent_Process_Name="*explorer.exe*" OR Parent_Process_Name="*svchost.exe*" OR Parent_Process_Name="*winlogon.exe*") AND Subject_User_Name="NT AUTHORITY\SYSTEM") | table _time, ComputerName, New_Process_Name, Parent_Process_Name, Process_Command_Line, Process_ID, Subject_User_Name

# Test 6: Suspicious WMI Execution via NLP Pattern Matching
# UNMAPPED - Windows Management Instrumentation
index=* sourcetype="WinEventLog:Security" | search (New_Process_Name="*wmic.exe") OR ((Process_Command_Line="*process call create*" OR Process_Command_Line="*process call terminate*" OR Process_Command_Line="*process where name*" OR Process_Command_Line="*service call start*" OR Process_Command_Line="*service call stop*" OR Process_Command_Line="*get process where name*" OR Process_Command_Line="*shadowcopy call create*" OR Process_Command_Line="*shadowcopy call delete*")) OR ((Process_Command_Line="*powershell.exe*" OR Process_Command_Line="*cmd.exe /c*" OR Process_Command_Line="*rundll32.exe*" OR Process_Command_Line="*regsvr32.exe*" OR Process_Command_Line="*bitsadmin.exe*" OR Process_Command_Line="*certutil.exe*" OR Process_Command_Line="*mshta.exe*")) OR ((Process_Command_Line="*Invoke-WebRequest*" OR Process_Command_Line="*IEX*" OR Process_Command_Line="*downloadstring*" OR Process_Command_Line="*Invoke-Expression*" OR Process_Command_Line="*http://*" OR Process_Command_Line="*https://*")) OR ((Process_Command_Line="*mimikatz*" OR Process_Command_Line="*procdump*" OR Process_Command_Line="*lsass.exe*" OR Process_Command_Line="*sekurlsa::*" OR Process_Command_Line="*privilege::*" OR Process_Command_Line="*dpapi::*" OR Process_Command_Line="*kerberos::*")) | table _time, ComputerName, New_Process_Name, Parent_Process_Name, Process_Command_Line, Process_ID, Subject_User_Name

# Test 7: Scheduled Task/Job Creation Detected via NLP Pattern Matching (Lazarus Group)
# UNMAPPED - Scheduled Task/Job
index=* sourcetype="WinEventLog:Security" | search ((New_Process_Name="*\schtasks.exe*" OR New_Process_Name="*\at.exe*")) OR ((Process_Command_Line="*schtasks /create*" OR Process_Command_Line="*at /create*")) OR (((Process_Command_Line LIKE "(/TN\s+"(?:[a-zA-Z0-9_\s\-]+\s*(?:[a-zA-Z0-9_\s\-]+)?)")") OR (Process_Command_Line LIKE "(/SC\s+ONCE\s+/ST\s+\d{2}:\d{2})") OR (Process_Command_Line LIKE "(/SC\s+DAILY\s+/ST\s+\d{2}:\d{2})") OR (Process_Command_Line LIKE "(/SC\s+WEEKLY\s+/D\s+\d+)") OR (Process_Command_Line LIKE "(/SC\s+MONTHLY\s+/D\s+\d+)"))) | table _time, ComputerName, New_Process_Name, Parent_Process_Name, Process_Command_Line, Process_ID, Subject_User_Name

# Test 8: Process Injection Detected via NLP Pattern Matching (Lazarus Group)
# UNMAPPED - Process Injection
index=* sourcetype="WinEventLog:Security" | search ((Process_Command_Line="*CreateRemoteThread*" OR Process_Command_Line="*VirtualAllocEx*" OR Process_Command_Line="*WriteProcessMemory*" OR Process_Command_Line="*NtCreateThreadEx*" OR Process_Command_Line="*QueueUserAPC*" OR Process_Command_Line="*RtlCreateUserThread*")) NOT ((Parent_Process_Name="*\svchost.exe" OR Parent_Process_Name="*\services.exe" OR Parent_Process_Name="*\lsass.exe" OR Parent_Process_Name="*\winlogon.exe" OR Parent_Process_Name="*\explorer.exe") AND (New_Process_Name="*\powershell.exe" OR New_Process_Name="*\cmd.exe" OR New_Process_Name="*\rundll32.exe") AND (Process_Command_Line="*powershell.exe -nop -w hidden -c*" OR Process_Command_Line="*cmd.exe /c start*" OR Process_Command_Line="*rundll32.exe*" OR Process_Command_Line="*regsvr32.exe /s*")) | table _time, ComputerName, New_Process_Name, Parent_Process_Name, Process_Command_Line, Process_ID, Subject_User_Name

# Test 9: Lazarus Group - Remote Services Activity via NLP Pattern Matching
# UNMAPPED - Remote Services
index=* sourcetype="WinEventLog:Security" | search ((New_Process_Name="*mimikatz.exe" OR New_Process_Name="*procdump.exe")) OR ((Process_Command_Line="*sekurlsa::logonpasswords*" OR Process_Command_Line="*sekurlsa::ekeys*" OR Process_Command_Line="*privilege::debug*" OR Process_Command_Line="*lsadump::sam*" OR Process_Command_Line="*lsadump::secrets*")) OR ((Parent_Process_Name="*powershell.exe" OR Parent_Process_Name="*cmd.exe") AND (Process_Command_Line="*-enc*" OR Process_Command_Line="*Invoke-WebRequest*" OR Process_Command_Line="*IEX*" OR Process_Command_Line="*powershell.exe -nop -w hidden -c*" OR Process_Command_Line="*bypass*" OR Process_Command_Line="*downloadstring*")) | table _time, ComputerName, New_Process_Name, Parent_Process_Name, Process_Command_Line, Process_ID, Subject_User_Name

# Test 10: Suspicious Data Archiving Activity Detected via NLP Pattern Matching
# UNMAPPED - Archive Collected Data
index=* sourcetype="WinEventLog:Security" | search ((Process_Command_Line="*archive*" OR Process_Command_Line="*backup*" OR Process_Command_Line="*compress*" OR Process_Command_Line="*zip*" OR Process_Command_Line="*rar*" OR Process_Command_Line="*7z*" OR Process_Command_Line="*tar*" OR Process_Command_Line="*gzip*" OR Process_Command_Line="*bzip2*") AND (New_Process_Name="*7z.exe" OR New_Process_Name="*zip.exe" OR New_Process_Name="*rar.exe" OR New_Process_Name="*tar.exe" OR New_Process_Name="*gzip.exe" OR New_Process_Name="*bzip2.exe")) NOT ((Process_Command_Line="*\Program Files\*" OR Process_Command_Line="*\Windows\*" OR Process_Command_Line="*\System32\*" OR Process_Command_Line="*\SysWOW64\*" OR Process_Command_Line="*-help*" OR Process_Command_Line="*-version*" OR Process_Command_Line="*--help*" OR Process_Command_Line="*--version*") AND (Parent_Process_Name="*explorer.exe*" OR Parent_Process_Name="*cmd.exe*" OR Parent_Process_Name="*powershell.exe*" OR Parent_Process_Name="*conhost.exe*")) | table _time, ComputerName, New_Process_Name, Parent_Process_Name, Process_Command_Line, Process_ID, Subject_User_Name

